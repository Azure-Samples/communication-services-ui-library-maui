# Azure Communication UI iOS Library MAUI Support

This project demonstrates the integration of Communication UI library into MAUI app.

## Getting Started

### Communication UI Library Proxy

Open `CommunicationUI-Proxy.xcworkspace` and in a terminal `pod install`.

### Create Frameworks

Under `iOSMauiBindings/ProxyLibs/CommunicationUI-Proxy/` there is a script to help you build the fat framework files `iOSFramework.sh`.

### Sharpie Bind

Sharpie bind helps to generate `iOSMauiBindings/iOS.CallingUI.Binding/ApiDefinitions.cs`. Make a copy of `communication-services-ui-library-maui/iOSMauiBindings/ProxyLibs/CommunicationUI-Proxy/DeviceFramework/Debug-iphoneos/CommunicationUI_Proxy.framework`, so we can work on it safely. Open up a Terminal in the directory that contains the framework and run the below command:

```
sharpie bind -sdk iphoneos -output ./ -namespace iOS.CallingUI.Binding -scope ./CommunicationUI_Proxy.framework/Headers ./CommunicationUI_Proxy.framework/Headers/CommunicationUI_Proxy-Swift.h
```

Sharpie should now have created new file in the directory `ApiDefinitions.cs`.

### Binding Library

Open `CommunicationUIProxy.Binding.sln`, and copy the `CommunicationUI_Proxy.framework` directory into the project and add it as a Native Reference.
Next copy the contents of `ApiDefinitions.cs` generated by Sharpie into the `/CommunicationUIProxy.Binding/.` folder.
Fix any build issues in the binding library.
At the top of the `ApiDefinitions.cs` add `using UIKit;`, and remove `using CommunicationUI_Proxy;`
You should now be able to build the binding library successfully
After building the library you should see a `bin` folder where the `.dll` files will be generated

### Sample App

Open `CommunicationCallingSampleMauiApp.sln`. Under the `CommunicationCallingSampleMauiApp` project find the `dependencies` folder right click and `Add Project Reference`. In the `.Net Assembly` tab we can browse to where the `.dll` of our binding library and add it as a reference.
Now you can including the library into your project by adding `using iOS.CallingUI.Binding;` at the top of you `.cs` files.

## Launching Composite

The MAUI library supports all the same features as the native UI [composite](https://github.com/Azure/communication-ui-library-ios).
Theming and callback method for error handling is optional and can be set to `null`
Developers can start the composite for a group call using a uuid.

```cs
CommunicationUIProxy _p = new CommunicationUIProxy();
GroupCallObjectProxy groupCall = new GroupCallObjectProxy();
groupCall.SetGroupCallProperties(<CALL_ID>, <DISPLAY_NAME>);
_p.StartExperienceWithGroupCall(groupCall, acsToken, null, null, null, (error) => OnHandleError(error), (rawIds) => OnRemoteParticipantJoined(rawIds));
```

Teams interop is also supported

```cs
CommunicationUIProxy _p = new CommunicationUIProxy();
TeamsMeetingObjectProxy teamsCall = new TeamsMeetingObjectProxy();
teamsCall.SetTeamsMeetingsProperties(<TEAMS_MEETING_URL>, <DISPLAY_NAME>);
_p.StartExperienceWithTeamsMeeting(teamsCall, acsToken, null, null, null, (error) => OnHandleError(error), (rawIds) => OnRemoteParticipantJoined(rawIds));
```
